<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Lista treninga</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ng-container *ngIf="loaded; else loading">
    <ng-container *ngIf="trainingEvents.length > 0" ; else noTrainingEvents>
      <ion-list inset>
        <ion-card
          *ngFor="let e of trainingEvents"
          class="ion-padding"
          (click)="openTrainingCardModal(getFilteredProfiles(e.exercisers))"
        >
          <ion-card-header>
            <ion-card-title> {{ e.date | date:'dd.MM.YYYY.' }} </ion-card-title>
            <ion-card-subtitle>
              {{ e.time.split(':')[0] }}:{{ e.time.split(':')[1] }}
            </ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <p>
              Preostala mesta za ovaj termin:
              <span>{{ e.exercisers.length }}/8</span>
            </p>
          </ion-card-content>
          
          <ng-container *ngIf="!isUserApplied(e.exercisers); else applied">
            <ion-button
              (click)="addUserToTraining(e.id, $event)"
              [disabled]="e.exercisers.length >= 8"
            >
              Prijavi se na trening
            </ion-button>
          </ng-container>

          <ng-template #applied>
            <ion-button
              (click)="cancelApplication(e.id, $event)"
            >
              Otkazi prijavu
            </ion-button>
          </ng-template>

        </ion-card>
      </ion-list>
    </ng-container>
  </ng-container>

  <ng-template #noTrainingEvents>
    <p>Trenutno nema dostupnih treninga.</p>
  </ng-template>

  <ng-template #loading>
    <div class="spinner-container">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
    </div>
  </ng-template>
</ion-content>

<ion-footer [translucent]="true">
  <ion-toolbar>
    <ion-button
      fill="outline"
      slot="start"
      [disabled]="!isAdmin()"
      (click)="openNewTrainingModal()"
    >
      Kreiraj novi trening
      <ion-icon slot="end" name="create"></ion-icon>
    </ion-button>
    <ion-button
      color="primary"
      slot="end"
      (click)="refreshTrainingEventsAndProfiles()"
    >
      Osvezi treninge
    </ion-button>
  </ion-toolbar>
</ion-footer>
